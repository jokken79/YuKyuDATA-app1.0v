<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YuKyu Premium Dashboard</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+JP:wght@400;500;700&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">

    <!-- Design System -->
    <link rel="stylesheet" href="/static/css/main.css">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <span style="font-size: 2rem;">‚ú®</span>
                <div>
                    <div style="font-weight: 800; letter-spacing: -0.5px;">YUKYU</div>
                    <div style="font-size: 0.7rem; color: var(--primary); letter-spacing: 2px;">PREMIUM</div>
                </div>
            </div>

            <div class="nav-item active" data-view="dashboard" onclick="App.ui.switchView('dashboard')">
                <span>üìä</span> <span>Dashboard</span>
            </div>
            <div class="nav-item" data-view="employees" onclick="App.ui.switchView('employees')">
                <span>üë•</span> <span>Employees</span>
            </div>
            <div class="nav-item" data-view="factories" onclick="App.ui.switchView('factories')">
                <span>üè≠</span> <span>Factories</span>
            </div>
            <div class="nav-item" data-view="requests" onclick="App.ui.switchView('requests')">
                <span>üìù</span> <span>Áî≥Ë´ã</span>
            </div>
            <div class="nav-item" data-view="compliance" onclick="App.ui.switchView('compliance')">
                <span>‚úÖ</span> <span>Compliance</span>
            </div>
            <div class="nav-item" style="margin-top: auto;" onclick="App.ui.switchView('settings')">
                <span>‚öôÔ∏è</span> <span>Settings</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Header -->
            <header class="flex-between" style="margin-bottom: 2rem;">
                <div>
                    <h1 class="text-gradient" style="font-size: 2.5rem;" id="page-title">Dashboard Overview</h1>
                    <p style="color: #64748b;" id="page-subtitle">Real-time vacation data analytics</p>
                </div>

                <div class="flex-center" gap="1rem">
                    <div id="year-filter" class="flex-center" style="gap: 0.5rem; margin-right: 1.5rem;"></div>
                    <button class="btn btn-primary" onclick="App.data.sync()">
                        <span>‚ö°</span> Sync Data
                    </button>
                    <button class="btn btn-glass" onclick="App.data.syncGenzai()" title="Sync Dispatch">
                        <span>üè¢</span>
                    </button>
                    <button class="btn btn-glass" onclick="App.data.syncUkeoi()" title="Sync Contract">
                        <span>üîß</span>
                    </button>
                </div>
            </header>

            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section active">

                <!-- Bento Grid Stats -->
                <div class="bento-grid">
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Total Usage</div>
                        <div class="stat-value" id="kpi-used">-</div>
                        <div class="badge badge-success">Active</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Remaining</div>
                        <div class="stat-value" id="kpi-balance" style="color: var(--warning);">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Utilization</div>
                        <div class="stat-value" id="kpi-rate">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1"
                        style="background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(37, 99, 235, 0.2)); border: 1px solid var(--primary); cursor: pointer;"
                        onclick="App.ui.switchView('employees')">
                        <div class="stat-label">Employees</div>
                        <div class="stat-value" id="kpi-total">-</div>
                        <div style="font-size: 0.8rem; margin-top: 5px;">Click to view all ‚Üí</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="bento-grid">
                    <div class="glass-panel col-span-2" style="padding: 1.5rem; height: 400px;">
                        <h3 class="stat-label" style="margin-bottom: 1rem;">Usage Distribution</h3>
                        <div style="position: relative; height: 320px; width: 100%;">
                            <canvas id="chart-distribution"></canvas>
                        </div>
                    </div>
                    <div class="glass-panel col-span-2" style="padding: 1.5rem; height: 400px;">
                        <h3 class="stat-label" style="margin-bottom: 1rem;">Monthly Trends (2025)</h3>
                        <div style="position: relative; height: 320px; width: 100%;">
                            <canvas id="chart-trends"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: EMPLOYEES -->
            <div id="view-employees" class="view-section" style="display: none;">
                <div class="glass-panel" style="padding: 2rem;">
                    <div class="flex-between" style="margin-bottom: 1.5rem;">
                        <div class="flex-center" style="gap: 1rem;">
                            <h3 style="font-size: 1.25rem;">Staff Directory</h3>
                            <div class="badge badge-warning" id="emp-count-badge">0 Employees</div>
                        </div>
                        <input type="text" id="search-input" placeholder="Search by name, ID, or factory..."
                            class="input-glass" style="width: 300px;" oninput="App.ui.handleSearch(this.value)">
                    </div>

                    <div style="overflow-x: auto; max-height: 70vh;">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Employee</th>
                                    <th>Factory</th>
                                    <th>Granted</th>
                                    <th>Used</th>
                                    <th>Balance</th>
                                    <th>Rate</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <tr>
                                    <td colspan="7" style="text-align:center; padding: 2rem;">Loading data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: FACTORIES -->
            <div id="view-factories" class="view-section" style="display: none;">
                <div class="glass-panel" style="padding: 1.5rem; height: 600px;">
                    <h3 class="stat-label" style="margin-bottom: 1rem;">Usage by Factory</h3>
                    <div style="position: relative; height: 500px; width: 100%;">
                        <canvas id="chart-factories"></canvas>
                    </div>
                </div>
            </div>

            <!-- VIEW: REQUESTS (Áî≥Ë´ã) -->
            <div id="view-requests" class="view-section" style="display: none;">
                <div class="bento-grid">
                    <!-- New Request Form -->
                    <div class="glass-panel col-span-2" style="padding: 2rem;">
                        <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">
                            üìù Êñ∞Ë¶èÊúâÁµ¶‰ºëÊöáÁî≥Ë´ã
                            <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">New Leave Request</span>
                        </h3>

                        <div id="request-form">
                            <!-- Employee Search -->
                            <div style="margin-bottom: 1.5rem;">
                                <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">ÂæìÊ•≠Âì°„ÇíÊ§úÁ¥¢ (Search Employee)</label>
                                <input type="text" id="emp-search" class="input-glass" style="width: 100%;"
                                    placeholder="ÂêçÂâç„Åæ„Åü„ÅØÁ§æÂì°Áï™Âè∑„ÅßÊ§úÁ¥¢..." oninput="App.requests.searchEmployee(this.value)">
                                <div id="emp-search-results" style="margin-top: 0.5rem; max-height: 200px; overflow-y: auto;"></div>
                            </div>

                            <!-- Selected Employee Info -->
                            <div id="selected-emp-info" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: rgba(56, 189, 248, 0.1); border-radius: 12px;">
                                <div class="flex-between">
                                    <div>
                                        <div id="selected-emp-name" style="font-weight: 600; font-size: 1.1rem;"></div>
                                        <div id="selected-emp-details" style="color: var(--muted); font-size: 0.85rem;"></div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div class="stat-label">ÊÆã„ÇäÊó•Êï∞</div>
                                        <div id="selected-emp-balance" style="font-size: 1.5rem; font-weight: 700; color: var(--success);"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Date Selection -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div>
                                    <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">ÈñãÂßãÊó• (Start Date)</label>
                                    <input type="date" id="start-date" class="input-glass" style="width: 100%;">
                                </div>
                                <div>
                                    <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">ÁµÇ‰∫ÜÊó• (End Date)</label>
                                    <input type="date" id="end-date" class="input-glass" style="width: 100%;">
                                </div>
                            </div>

                            <!-- Days & Type -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div>
                                    <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">Êó•Êï∞ (Days)</label>
                                    <input type="number" id="days-requested" class="input-glass" style="width: 100%;"
                                        min="0.5" step="0.5" value="1">
                                </div>
                                <div>
                                    <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">Á®ÆÈ°û (Type)</label>
                                    <select id="leave-type" class="input-glass" style="width: 100%;">
                                        <option value="full">ÂÖ®Êó•‰ºëÊöá (Full Day)</option>
                                        <option value="half_am">ÂçàÂâçÂçä‰ºë (AM Half)</option>
                                        <option value="half_pm">ÂçàÂæåÂçä‰ºë (PM Half)</option>
                                        <option value="hourly">ÊôÇÈñì‰ºë (Hourly)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Reason -->
                            <div style="margin-bottom: 1.5rem;">
                                <label class="stat-label" style="display: block; margin-bottom: 0.5rem;">ÁêÜÁî± (Reason)</label>
                                <textarea id="leave-reason" class="input-glass" style="width: 100%; min-height: 80px; resize: vertical;"
                                    placeholder="ÁßÅÁî®„ÄÅÈÄöÈô¢„ÄÅÊóÖË°å„Å™„Å©..."></textarea>
                            </div>

                            <!-- Submit Button -->
                            <button class="btn btn-primary" style="width: 100%; padding: 1rem;" onclick="App.requests.submit()">
                                üì§ Áî≥Ë´ã„Åô„Çã (Submit Request)
                            </button>
                        </div>
                    </div>

                    <!-- Pending Requests -->
                    <div class="glass-panel col-span-2" style="padding: 2rem;">
                        <div class="flex-between" style="margin-bottom: 1.5rem;">
                            <h3 style="font-size: 1.25rem;">
                                ‚è≥ ÊâøË™çÂæÖ„Å°
                                <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">Pending Approvals</span>
                            </h3>
                            <button class="btn btn-glass" onclick="App.requests.loadPending()">
                                üîÑ Êõ¥Êñ∞
                            </button>
                        </div>

                        <div id="pending-requests" style="max-height: 400px; overflow-y: auto;">
                            <div style="text-align: center; color: var(--muted); padding: 2rem;">
                                Loading pending requests...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Request History -->
                <div class="glass-panel" style="padding: 2rem; margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">
                        üìã Áî≥Ë´ãÂ±•Ê≠¥
                        <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">Request History</span>
                    </h3>
                    <div style="overflow-x: auto;">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ÂæìÊ•≠Âì°</th>
                                    <th>ÊúüÈñì</th>
                                    <th>Êó•Êï∞</th>
                                    <th>ÁêÜÁî±</th>
                                    <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                    <th>Áî≥Ë´ãÊó•</th>
                                </tr>
                            </thead>
                            <tbody id="requests-history">
                                <tr><td colspan="7" style="text-align: center; padding: 2rem;">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: COMPLIANCE -->
            <div id="view-compliance" class="view-section" style="display: none;">
                <div class="bento-grid">
                    <!-- 5 Day Compliance -->
                    <div class="glass-panel col-span-2" style="padding: 2rem;">
                        <div class="flex-between" style="margin-bottom: 1.5rem;">
                            <h3 style="font-size: 1.25rem;">
                                üìä 5Êó•ÂèñÂæóÁæ©Âãô „ÉÅ„Çß„ÉÉ„ÇØ
                                <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">5-Day Compliance Check</span>
                            </h3>
                            <button class="btn btn-primary" onclick="App.compliance.check5Day()">
                                üîç „ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å
                            </button>
                        </div>

                        <div id="compliance-summary" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="stat-card" style="text-align: center;">
                                <div class="stat-label">ÂØæË±°ËÄÖ</div>
                                <div class="stat-value" id="comp-total">-</div>
                            </div>
                            <div class="stat-card" style="text-align: center; border-color: var(--success);">
                                <div class="stat-label">ÈÅîÊàê</div>
                                <div class="stat-value" id="comp-compliant" style="color: var(--success);">-</div>
                            </div>
                            <div class="stat-card" style="text-align: center; border-color: var(--warning);">
                                <div class="stat-label">Ë¶ÅÊ≥®ÊÑè</div>
                                <div class="stat-value" id="comp-atrisk" style="color: var(--warning);">-</div>
                            </div>
                            <div class="stat-card" style="text-align: center; border-color: var(--danger);">
                                <div class="stat-label">Êú™ÈÅîÊàê</div>
                                <div class="stat-value" id="comp-noncompliant" style="color: var(--danger);">-</div>
                            </div>
                        </div>

                        <div id="compliance-list" style="max-height: 300px; overflow-y: auto;">
                            <div style="text-align: center; color: var(--muted); padding: 2rem;">
                                Click "„ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å" to check compliance
                            </div>
                        </div>
                    </div>

                    <!-- Alerts -->
                    <div class="glass-panel col-span-2" style="padding: 2rem;">
                        <div class="flex-between" style="margin-bottom: 1.5rem;">
                            <h3 style="font-size: 1.25rem;">
                                üö® „Ç¢„É©„Éº„Éà
                                <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">Compliance Alerts</span>
                            </h3>
                            <button class="btn btn-glass" onclick="App.compliance.loadAlerts()">
                                üîÑ Êõ¥Êñ∞
                            </button>
                        </div>

                        <div id="alerts-container" style="max-height: 400px; overflow-y: auto;">
                            <div style="text-align: center; color: var(--muted); padding: 2rem;">
                                Loading alerts...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Annual Ledger -->
                <div class="glass-panel" style="padding: 2rem; margin-top: 1.5rem;">
                    <div class="flex-between" style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.25rem;">
                            üìí Âπ¥Ê¨°ÊúâÁµ¶‰ºëÊöáÁÆ°ÁêÜÁ∞ø
                            <span style="font-size: 0.8rem; color: var(--muted); margin-left: 0.5rem;">Annual Leave Ledger (Required by Law)</span>
                        </h3>
                        <div class="flex-center" style="gap: 0.5rem;">
                            <button class="btn btn-glass" onclick="App.compliance.loadLedger()">
                                üìÑ Ë°®Á§∫
                            </button>
                            <button class="btn btn-primary" onclick="App.compliance.exportLedger('csv')">
                                üíæ CSVÂá∫Âäõ
                            </button>
                        </div>
                    </div>

                    <div id="ledger-container" style="overflow-x: auto; max-height: 400px;">
                        <div style="text-align: center; color: var(--muted); padding: 2rem;">
                            Click "Ë°®Á§∫" to load the annual ledger
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section" style="display: none;">
                <div class="glass-panel" style="padding: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">‚öôÔ∏è „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö</h3>

                    <div style="display: grid; gap: 2rem;">
                        <!-- System Status -->
                        <div>
                            <h4 class="stat-label" style="margin-bottom: 1rem;">„Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã</h4>
                            <div id="system-status" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                                <div class="stat-card" style="text-align: center;">
                                    <div class="stat-label">Database Size</div>
                                    <div class="stat-value" id="sys-db-size">-</div>
                                </div>
                                <div class="stat-card" style="text-align: center;">
                                    <div class="stat-label">Total Employees</div>
                                    <div class="stat-value" id="sys-emp-count">-</div>
                                </div>
                                <div class="stat-card" style="text-align: center;">
                                    <div class="stat-label">Health Status</div>
                                    <div class="stat-value" id="sys-health" style="color: var(--success);">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management -->
                        <div>
                            <h4 class="stat-label" style="margin-bottom: 1rem;">„Éá„Éº„ÇøÁÆ°ÁêÜ</h4>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-glass" onclick="App.settings.loadSnapshot()">
                                    üìä SnapshotÊõ¥Êñ∞
                                </button>
                                <button class="btn btn-glass" onclick="App.settings.viewAuditLog()">
                                    üìú Áõ£Êüª„É≠„Ç∞
                                </button>
                                <button class="btn btn-glass" onclick="App.data.sync()" style="background: rgba(56, 189, 248, 0.2);">
                                    ‚ö° „Éá„Éº„ÇøÂêåÊúü
                                </button>
                            </div>
                        </div>

                        <!-- API Info -->
                        <div>
                            <h4 class="stat-label" style="margin-bottom: 1rem;">APIÊÉÖÂ†±</h4>
                            <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
                                <div style="color: var(--muted);">Base URL:</div>
                                <div style="color: var(--primary);">http://localhost:8000/api</div>
                                <div style="color: var(--muted); margin-top: 0.5rem;">Documentation:</div>
                                <div><a href="/docs" target="_blank" style="color: var(--primary);">http://localhost:8000/docs</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- UI Elements -->
    <div class="loader-overlay" id="loader">
        <div class="spinner"></div>
        <div style="margin-top: 1rem; color: #94a3b8; font-weight: 600;">Processing Intelligence...</div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <!-- Simple Modal for Details -->
    <div class="loader-overlay" id="detail-modal" style="background: rgba(0,0,0,0.7);">
        <div class="glass-panel" style="width: 500px; max-width: 90%; position: relative;">
            <button class="btn"
                style="position: absolute; right: 10px; top: 10px; background: transparent; color: white;"
                onclick="App.ui.closeModal()">‚úï</button>
            <div style="padding: 2rem;">
                <h2 id="modal-title" style="margin-bottom: 1rem;">Employee Details</h2>
                <div id="modal-content"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>