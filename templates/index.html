<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>YuKyu Premium Dashboard</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="ÊúâÁµ¶‰ºëÊöáÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† - Premium Dashboard for managing paid leave">
    <meta name="theme-color" content="#06b6d4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="YuKyu">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="YuKyu Premium">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/static/icons/icon.svg">
    <link rel="apple-touch-icon" href="/static/icons/icon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+JP:wght@400;500;700&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">

    <!-- Design System - Vibrant Arari Style -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/sidebar-premium.css">
    <link rel="stylesheet" href="/static/css/arari-glow.css">
    <link rel="stylesheet" href="/static/css/theme-override.css">
    <link rel="stylesheet" href="/static/css/light-mode-premium.css">
    <link rel="stylesheet" href="/static/css/modern-2025.css">
    <link rel="stylesheet" href="/static/css/design-system/utilities.css">
    <link rel="stylesheet" href="/static/css/design-system/accessibility.css">

    <!-- Libraries -->
    <!-- ApexCharts - Modern charting library -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>

    <!-- Chart.js - For pie and bar charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- GSAP - Professional-grade animations -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollToPlugin.min.js"></script>

    <!-- Animate.css - Quick CSS animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- Flatpickr - Modern Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/themes/dark.css">

    <style>
        /* Custom Flatpickr Styles - Cyan/Glass Theme - PURE BLACK */
        .flatpickr-calendar {
            background: rgba(5, 5, 5, 0.98) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(6, 182, 212, 0.3) !important;
            border-radius: 16px !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7),
                0 0 0 1px rgba(6, 182, 212, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
        }

        .flatpickr-months {
            background: transparent !important;
            border-bottom: 1px solid rgba(6, 182, 212, 0.2) !important;
            padding: 10px 0 !important;
        }

        .flatpickr-current-month {
            color: #06b6d4 !important;
            font-weight: 600 !important;
        }

        .flatpickr-months .flatpickr-prev-month,
        .flatpickr-months .flatpickr-next-month {
            fill: #06b6d4 !important;
            transition: all 0.2s ease !important;
        }

        .flatpickr-months .flatpickr-prev-month:hover,
        .flatpickr-months .flatpickr-next-month:hover {
            fill: #22d3ee !important;
            transform: scale(1.1) !important;
        }

        .flatpickr-weekday {
            color: #94a3b8 !important;
            font-weight: 500 !important;
            font-size: 0.85rem !important;
        }

        .flatpickr-day {
            color: #e2e8f0 !important;
            border-radius: 8px !important;
            transition: all 0.2s ease !important;
            border: none !important;
        }

        .flatpickr-day:hover {
            background: rgba(6, 182, 212, 0.2) !important;
            border-color: transparent !important;
            transform: scale(1.05) !important;
        }

        .flatpickr-day.selected,
        .flatpickr-day.startRange,
        .flatpickr-day.endRange {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
            border-color: #06b6d4 !important;
            color: #ffffff !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4) !important;
        }

        .flatpickr-day.inRange {
            background: rgba(6, 182, 212, 0.15) !important;
            border-color: transparent !important;
            box-shadow: none !important;
        }

        .flatpickr-day.today {
            border: 2px solid #f472b6 !important;
            color: #f472b6 !important;
            font-weight: 600 !important;
        }

        .flatpickr-day.today:hover {
            border-color: #f472b6 !important;
            background: rgba(244, 114, 182, 0.2) !important;
        }

        .flatpickr-day.disabled,
        .flatpickr-day.prevMonthDay,
        .flatpickr-day.nextMonthDay {
            color: #475569 !important;
        }

        .flatpickr-day.disabled:hover,
        .flatpickr-day.prevMonthDay:hover,
        .flatpickr-day.nextMonthDay:hover {
            background: transparent !important;
            cursor: not-allowed !important;
            transform: none !important;
        }

        .numInputWrapper:hover {
            background: rgba(6, 182, 212, 0.1) !important;
        }

        .flatpickr-monthDropdown-months,
        .numInput {
            background: rgba(5, 5, 5, 0.9) !important;
            color: #06b6d4 !important;
            border: 1px solid rgba(6, 182, 212, 0.3) !important;
            border-radius: 6px !important;
        }

        .flatpickr-monthDropdown-months:hover,
        .numInput:hover {
            background: rgba(6, 182, 212, 0.15) !important;
        }

        .flatpickr-time {
            border-top: 1px solid rgba(6, 182, 212, 0.2) !important;
        }

        .flatpickr-time input {
            color: #06b6d4 !important;
        }

        .flatpickr-time input:hover,
        .flatpickr-time input:focus {
            background: rgba(6, 182, 212, 0.1) !important;
        }

        /* Glass effect enhancement */
        .flatpickr-calendar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg,
                    rgba(6, 182, 212, 0.05) 0%,
                    rgba(8, 145, 178, 0.03) 100%);
            border-radius: 16px;
            pointer-events: none;
        }

        /* Animation for calendar opening */
        .flatpickr-calendar.open {
            animation: flatpickrFadeIn 0.2s ease-out;
        }

        @keyframes flatpickrFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <!-- Modern UI Enhancements 2025 -->
    <script src="/static/js/modern-ui.js" defer></script>
</head>

<body>
    <!-- Skip Navigation for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="app-container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation menu"
            aria-expanded="false">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

        <!-- Sidebar Navigation - Premium Design -->
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <img src="/static/icons/logo-premium.svg" alt="YuKyu - Employee Vacation Management System" width="48" height="48">
                <div>
                    <div>YUKYU</div>
                    <div>DATA</div>
                </div>
            </div>

            <div class="nav-section">
                <!-- Main Navigation Group -->
                <div class="nav-group">
                    <div class="nav-group-label">Main</div>

                    <button class="nav-item active" data-view="dashboard" onclick="App.ui.switchView('dashboard')"
                            aria-label="Dashboard" aria-current="page" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="7" height="7" rx="1" />
                                <rect x="14" y="3" width="7" height="7" rx="1" />
                                <rect x="3" y="14" width="7" height="7" rx="1" />
                                <rect x="14" y="14" width="7" height="7" rx="1" />
                            </svg>
                        </span>
                        <span class="nav-text">Dashboard</span>
                    </button>

                    <button class="nav-item" data-view="employees" onclick="App.ui.switchView('employees')"
                            aria-label="Employees" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="9" cy="7" r="4" />
                                <path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
                                <circle cx="17" cy="7" r="3" />
                                <path d="M21 21v-2a3 3 0 0 0-2-2.83" />
                            </svg>
                        </span>
                        <span class="nav-text">Employees</span>
                        <span class="nav-badge" aria-label="1377 employees">1377</span>
                    </button>

                    <button class="nav-item" data-view="factories" onclick="App.ui.switchView(\'factories\')" aria-label="Factories" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 20V8l6-4v4l6-4v4l6-4v16H2z" />
                                <path d="M6 12v4" />
                                <path d="M10 12v4" />
                                <path d="M14 12v4" />
                                <path d="M18 12v4" />
                            </svg>
                        </span>
                        <span class="nav-text">Factories</span>
                    </button>
                </div>

                <!-- Requests Group -->
                <div class="nav-group">
                    <div class="nav-group-label">Requests</div>

                    <button class="nav-item" data-view="requests" onclick="App.ui.switchView(\'requests\')" aria-label="Request Leave" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <line x1="10" y1="9" x2="8" y2="9" />
                            </svg>
                        </span>
                        <span class="nav-text">Áî≥Ë´ã Request</span>
                    </button>

                    <button class="nav-item" data-view="calendar" onclick="App.ui.switchView(\'calendar\')" aria-label="Calendar" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                <line x1="16" y1="2" x2="16" y2="6" />
                                <line x1="8" y1="2" x2="8" y2="6" />
                                <line x1="3" y1="10" x2="21" y2="10" />
                                <path d="M8 14h.01" />
                                <path d="M12 14h.01" />
                                <path d="M16 14h.01" />
                                <path d="M8 18h.01" />
                                <path d="M12 18h.01" />
                            </svg>
                        </span>
                        <span class="nav-text">„Ç´„É¨„É≥„ÉÄ„Éº</span>
                    </button>
                </div>

                <!-- Analytics Group -->
                <div class="nav-group">
                    <div class="nav-group-label">Analytics</div>

                    <button class="nav-item" data-view="compliance" onclick="App.ui.switchView(\'compliance\')" aria-label="Compliance" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                <polyline points="9 12 11 14 15 10" />
                            </svg>
                        </span>
                        <span class="nav-text">Compliance</span>
                    </button>

                    <button class="nav-item" data-view="analytics" onclick="App.ui.switchView(\'analytics\')" aria-label="Analytics" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="20" x2="18" y2="10" />
                                <line x1="12" y1="20" x2="12" y2="4" />
                                <line x1="6" y1="20" x2="6" y2="14" />
                            </svg>
                        </span>
                        <span class="nav-text">ÂàÜÊûê Analytics</span>
                    </button>

                    <button class="nav-item" data-view="reports" onclick="App.ui.switchView(\'reports\')" aria-label="Monthly Reports" type="button">
                        <span class="nav-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="12" y1="18" x2="12" y2="12" />
                                <line x1="9" y1="15" x2="15" y2="15" />
                            </svg>
                        </span>
                        <span class="nav-text">ÊúàÊ¨°„É¨„Éù„Éº„Éà</span>
                    </button>
                </div>
            </div>

            <!-- Settings at bottom -->
            <div class="sidebar-footer">
                <button class="nav-item nav-item-settings" data-view="settings" onclick="App.ui.switchView(\'settings\')" aria-label="Settings" type="button">
                    <span class="nav-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                        </svg>
                    </span>
                    <span class="nav-text">Settings</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="main-content">

            <!-- Header -->
            <header class="flex-between mb-lg">
                <div>
                    <h1 class="text-gradient" style="font-size: 2.5rem;" id="page-title">Dashboard Overview</h1>
                    <p class="text-muted" id="page-subtitle">Real-time vacation data analytics</p>
                </div>

                <div class="flex-center gap-md">
                    <div class="flex-center gap-sm mr-md" id="year-filter"></div>

                    <!-- Theme Toggle -->
                    <button class="theme-toggle" onclick="App.theme.toggle()" title="„ÉÜ„Éº„ÉûÂàáÊõø" aria-label="Toggle theme" type="button">
                        <div class="theme-toggle-track">
                            <div class="theme-toggle-thumb">
                                <span id="theme-icon">üåô</span>
                            </button>
                        </div>
                        <span class="theme-toggle-label" id="theme-label">Dark</span>
                    </div>

                    <button class="btn btn-primary" id="btn-sync-main" onclick="App.data.sync()" aria-label="Sync vacation data" type="button">
                        <span class="btn-icon" aria-hidden="true">‚ö°</span>
                        <span class="btn-text">Sync</span>
                        <span class="btn-spinner d-none"></span>
                    </button>
                    <button class="btn btn-glass" id="btn-sync-genzai" onclick="App.data.syncGenzai()"
                        title="Sync Dispatch Employees" aria-label="Sync dispatch employees" type="button">
                        <span class="btn-icon" aria-hidden="true">üè¢</span>
                        <span class="btn-spinner d-none"></span>
                    </button>
                    <button class="btn btn-glass" id="btn-sync-ukeoi" onclick="App.data.syncUkeoi()"
                        title="Sync Contract Employees" aria-label="Sync contract employees" type="button">
                        <span class="btn-icon" aria-hidden="true">üîß</span>
                        <span class="btn-spinner d-none"></span>
                    </button>
                </div>
            </header>

            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section active">

                <!-- Bento Grid Stats with Progress Rings -->
                <div class="bento-grid stagger-children" role="region" aria-label="Statistics Overview">
                    <!-- Usage Ring -->
                    <div class="glass-panel stat-card stat-card-ring col-span-1 glow-hover">
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__circle-bg" cx="40" cy="40" r="34"></circle>
                                <circle class="progress-ring__circle progress-ring__circle--success" id="ring-usage" role="img" aria-label="Usage progress"
                                    cx="40" cy="40" r="34" stroke-dasharray="213.6" stroke-dashoffset="213.6"></circle>
                            </svg>
                            <div class="progress-ring__value" id="ring-usage-value">0</div>
                        </div>
                        <div class="stat-label">Total Usage</div>
                        <div class="text-xs text-muted" id="kpi-used-detail">0 days
                        </div>
                    </div>

                    <!-- Balance Ring -->
                    <div class="glass-panel stat-card stat-card-ring col-span-1 glow-hover">
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__circle-bg" cx="40" cy="40" r="34"></circle>
                                <circle class="progress-ring__circle progress-ring__circle--warning" id="ring-balance" role="img" aria-label="Balance progress"
                                    cx="40" cy="40" r="34" stroke-dasharray="213.6" stroke-dashoffset="213.6"></circle>
                            </svg>
                            <div class="progress-ring__value" id="ring-balance-value">0</div>
                        </div>
                        <div class="stat-label">Remaining</div>
                        <div class="text-xs text-muted" id="kpi-balance-detail">0
                            days left</div>
                    </div>

                    <!-- Utilization Ring -->
                    <div class="glass-panel stat-card stat-card-ring col-span-1 glow-hover">
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__circle-bg" cx="40" cy="40" r="34"></circle>
                                <circle class="progress-ring__circle progress-ring__circle--primary" id="ring-rate" role="img" aria-label="Utilization rate"
                                    cx="40" cy="40" r="34" stroke-dasharray="213.6" stroke-dashoffset="213.6"></circle>
                            </svg>
                            <div class="progress-ring__value" id="ring-rate-value">0%</div>
                        </div>
                        <div class="stat-label">Utilization</div>
                        <div class="text-xs text-muted" id="kpi-rate-detail">avg rate
                        </div>
                    </div>

                    <!-- Employees Card -->
                    <div class="glass-panel stat-card col-span-1"
                        style="background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(37, 99, 235, 0.2)); border: 1px solid var(--primary); cursor: pointer;"
                        onclick="App.ui.switchView('employees')">
                        <div class="stat-label">Employees</div>
                        <div class="stat-value count-up" id="kpi-total">-</div>
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="quick-stat-value" id="qs-haken">0</div>
                                <div class="quick-stat-label">Ê¥æÈÅ£</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value" id="qs-ukeoi">0</div>
                                <div class="quick-stat-label">Ë´ãË≤†</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value" id="qs-staff">0</div>
                                <div class="quick-stat-label">Staff</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Gauge Row -->
                <div class="bento-grid mb-lg">
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">üìä Compliance Gauge (5Êó•ÊúÄ‰ΩéÊ∂àÂåñ)</h3>
                        <div class="gauge-container">
                            <svg class="gauge-svg" viewBox="0 0 200 120">
                                <path class="gauge-bg" d="M 20 100 A 80 80 0 0 1 180 100" />
                                <path class="gauge-fill" id="gauge-compliance" d="M 20 100 A 80 80 0 0 1 180 100"
                                    stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke="var(--success)" />
                            </svg>
                            <div class="gauge-value" id="gauge-value">0%</div>
                            <div class="gauge-label">compliance rate</div>
                            <div class="gauge-markers">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        <div
                            class="text-center mt-lg text-sm text-muted">
                            <span id="compliance-count">0</span> of <span id="compliance-total">0</span>
                            employees have used ‚â•5 days
                        </div>
                    </div>

                    <!-- Expiring Days Alert -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">‚ö†Ô∏è Days Expiring Soon</h3>
                        <div id="expiring-alert">
                            <div class="countdown-card d-none" id="countdown-container">
                                <div class="countdown-icon">‚è∞</div>
                                <div class="countdown-info">
                                    <div class="countdown-title">ÊúâÁµ¶‰ºëÊöá„ÅåÂ§±Âäπ‰∫àÂÆö</div>
                                    <div class="countdown-value" id="expiring-days">0 days</div>
                                    <div class="countdown-detail" id="expiring-detail">from 0 employees</div>
                                </div>
                            </div>
                            <div id="no-expiring" class="text-center p-xl text-success">
                                ‚úÖ No days expiring soon!
                            </div>
                        </div>
                        <div class="quick-stats mt-lg">
                            <div class="quick-stat">
                                <div class="quick-stat-value text-danger" id="critical-count">
                                    0</div>
                                <div class="quick-stat-label">Critical (0Êó•)</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value text-warning" id="warning-count">
                                    0</div>
                                <div class="quick-stat-label">Warning (&lt;3Êó•)</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value text-success" id="healthy-count">
                                    0</div>
                                <div class="quick-stat-label">Healthy (‚â•5Êó•)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="bento-grid">
                    <div class="glass-panel col-span-2 p-md" style="height: 400px;">
                        <h3 class="stat-label mb-lg">Usage Distribution</h3>
                        <div class="chart-container-sm">
                            <div id="chart-distribution"></div>
                        </div>
                    </div>
                    <div class="glass-panel col-span-2 p-md" style="height: 400px;">
                        <h3 class="stat-label mb-lg">Monthly Trends (2025)</h3>
                        <div class="chart-container-sm">
                            <div id="chart-trends"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: EMPLOYEES -->
            <div class="view-section d-none" id="view-employees">
                <div class="glass-panel p-lg">
                    <div class="flex-between mb-lg">
                        <div class="flex-center gap-md">
                            <h3 class="text-xl">ÂæìÊ•≠Âì°‰∏ÄË¶ß</h3>
                            <div class="badge badge-warning" id="emp-count-badge">0 Employees</div>
                        </div>
                        <div class="flex-center gap-md">
                            <label class="flex-center gap-sm cursor-pointer" for="active-only-toggle">
                                <input type="checkbox" id="active-only-toggle" checked
                                    onchange="App.employeeTypes.toggleActiveFilter()">
                                <span class="text-sm">Âú®ËÅ∑‰∏≠„ÅÆ„Åø</span>
                            </label>
                            <label for="search-input" class="sr-only">Search employees</label>
                            <input type="text" id="search-input" placeholder="Search by name, ID, or factory..."
                                class="input-glass" style="width: 300px;" oninput="App.ui.handleSearch(this.value)"
                                aria-label="Search employees by name, ID, or factory">
                        </div>
                    </div>
                    <!-- Type Filter Tabs -->
                    <div class="type-filter-tabs mb-lg flex gap-sm flex-wrap" id="type-filter-tabs">
                        <button class="btn btn-glass type-tab active" data-type="all"
                            onclick="App.ui.filterByType('all')">
                            <span class="tab-label">ÂÖ®Âì°</span>
                            <span class="tab-count" id="count-all">0</span>
                        </button>
                        <button class="btn btn-glass type-tab" data-type="genzai"
                            onclick="App.ui.filterByType('genzai')">
                            <span class="tab-label">Ê¥æÈÅ£ Dispatch</span>
                            <span class="tab-count" id="count-genzai">0</span>
                        </button>
                        <button class="btn btn-glass type-tab" data-type="ukeoi" onclick="App.ui.filterByType('ukeoi')">
                            <span class="tab-label">Ë´ãË≤† Contract</span>
                            <span class="tab-count" id="count-ukeoi">0</span>
                        </button>
                        <button class="btn btn-glass type-tab" data-type="staff" onclick="App.ui.filterByType('staff')">
                            <span class="tab-label">Á§æÂì° Staff</span>
                            <span class="tab-count" id="count-staff">0</span>
                        </button>
                    </div>

                    <!-- Employee Type Tabs -->
                    <div class="employee-tabs flex gap-sm mb-lg">
                        <button class="btn btn-glass active" id="tab-all" onclick="App.employeeTypes.switchTab('all')">
                            „Åô„Åπ„Å¶ (All)
                            <span class="badge badge-primary ml-sm" id="count-all">0</span>
                        </button>
                        <button class="btn btn-glass" id="tab-haken" onclick="App.employeeTypes.switchTab('haken')">
                            üè≠ Ê¥æÈÅ£ (Haken)
                            <span class="badge badge-info ml-sm" id="count-haken">0</span>
                        </button>
                        <button class="btn btn-glass" id="tab-ukeoi" onclick="App.employeeTypes.switchTab('ukeoi')">
                            üìã Ë´ãË≤† (Ukeoi)
                            <span class="badge badge-success ml-sm" id="count-ukeoi">0</span>
                        </button>
                        <button class="btn btn-glass" id="tab-staff" onclick="App.employeeTypes.switchTab('staff')">
                            üëî „Çπ„Çø„ÉÉ„Éï (Staff)
                            <span class="badge badge-warning ml-sm" id="count-staff">0</span>
                        </button>
                    </div>

                    <!-- Summary Cards by Type -->
                    <div class="bento-grid gap-md mb-lg" style="grid-template-columns: repeat(4, 1fr);">
                        <div class="kpi-card info-card-cyan">
                            <div class="stat-label">Ê¥æÈÅ£ ‰ΩøÁî®Êó•Êï∞</div>
                            <div class="stat-value" id="haken-used">0</div>
                        </div>
                        <div class="kpi-card info-card-success">
                            <div class="stat-label">Ë´ãË≤† ‰ΩøÁî®Êó•Êï∞</div>
                            <div class="stat-value" id="ukeoi-used">0</div>
                        </div>
                        <div class="kpi-card info-card-warning">
                            <div class="stat-label">„Çπ„Çø„ÉÉ„Éï ‰ΩøÁî®Êó•Êï∞</div>
                            <div class="stat-value" id="staff-used">0</div>
                        </div>
                        <div class="kpi-card info-card-purple">
                            <div class="stat-label">ÂêàË®à ‰ΩøÁî®Êó•Êï∞</div>
                            <div class="stat-value" id="total-type-used">0</div>
                        </div>
                    </div>

                    <div class="overflow-auto" style="max-height: 60vh;">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Employee</th>
                                    <th>Type</th>
                                    <th>Factory/Business</th>
                                    <th>Granted</th>
                                    <th>Used</th>
                                    <th>Balance</th>
                                    <th>Rate</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!-- Skeleton loading rows -->
                                <tr class="skeleton-row">
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 60px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 100px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 50px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 120px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 40px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 40px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 40px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 50px; height: 16px;">
                                        </div>
                                    </td>
                                </tr>
                                <tr class="skeleton-row">
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 55px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 90px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 45px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 110px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 35px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 35px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 35px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 45px; height: 16px;">
                                        </div>
                                    </td>
                                </tr>
                                <tr class="skeleton-row">
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 65px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 95px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 55px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 100px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 38px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 38px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 38px; height: 16px;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text" style="width: 48px; height: 16px;">
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: FACTORIES -->
            <div class="view-section d-none" id="view-factories">
                <div class="glass-panel p-md" style="height: 600px;">
                    <h3 class="stat-label mb-lg">Usage by Factory</h3>
                    <div class="chart-container-lg">
                        <div id="chart-factories"></div>
                    </div>
                </div>
            </div>

            <!-- VIEW: REQUESTS (Áî≥Ë´ã) -->
            <div class="view-section d-none" id="view-requests">
                <div class="bento-grid">
                    <!-- New Request Form -->
                    <div class="glass-panel col-span-2 p-lg">
                        <h3 class="mb-2xl text-xl">
                            üìù Êñ∞Ë¶èÊúâÁµ¶‰ºëÊöáÁî≥Ë´ã
                            <span class="text-xs text-muted ml-sm">New Leave
                                Request</span>
                        </h3>

                        <div id="request-form">
                            <!-- Progress Steps -->
                            <div class="progress-steps">
                                <div class="progress-step active" id="step-1">
                                    <div class="progress-step-number">1</div>
                                    <div class="progress-step-label">ÂæìÊ•≠Âì°ÈÅ∏Êäû</div>
                                </div>
                                <div class="progress-step" id="step-2">
                                    <div class="progress-step-number">2</div>
                                    <div class="progress-step-label">Êó•Á®ã„ÉªÁ®ÆÈ°û</div>
                                </div>
                                <div class="progress-step" id="step-3">
                                    <div class="progress-step-number">3</div>
                                    <div class="progress-step-label">Á¢∫Ë™ç„ÉªÈÄÅ‰ø°</div>
                                </div>
                            </div>

                            <!-- SECTION 1: Employee Selection -->
                            <div class="form-section">
                                <div class="form-section-title">üë§ ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû</div>

                                <div class="form-group">
                                    <label for="factory-filter">üè≠ Â∑•Â†¥„ÅßÁµûËæº„Åø (Filter by Factory)</label>
                                    <select class="input-glass w-full" id="factory-filter"
                                        onchange="App.requests.filterByFactory()">
                                        <option value="">„Åô„Åπ„Å¶„ÅÆÂ∑•Â†¥ (All Factories)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="emp-search" class="required">üîç ÂæìÊ•≠Âì°„ÇíÊ§úÁ¥¢ (Search Employee)</label>
                                    <input class="input-glass w-full" type="text" id="emp-search"
                                        placeholder="ÂêçÂâç„Åæ„Åü„ÅØÁ§æÂì°Áï™Âè∑„ÅßÊ§úÁ¥¢..." oninput="App.requests.searchEmployee(this.value)"
                                        aria-describedby="emp-search-validation">
                                    <div id="emp-search-validation" class="validation-message"></div>
                                    <div id="emp-search-results"
                                        class="mt-sm max-h-200"></div>
                                </div>
                            </div>

                            <!-- Selected Employee Info -->
                            <div id="selected-emp-info"
                                class="d-none mb-xl bg-cyan-highlight">
                                <div class="flex-between">
                                    <div>
                                        <div id="selected-emp-name" class="font-semibold text-lg"></div>
                                        <div id="selected-emp-details" class="text-muted text-sm">
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="stat-label">ÊÆã„ÇäÊó•Êï∞</div>
                                        <div id="selected-emp-balance"
                                            class="text-2xl font-bold text-success">
                                        </div>
                                    </div>
                                </div>
                                <!-- Hourly wage info (shown when available) -->
                                <div id="hourly-wage-info"
                                    class="d-none mt-md pt-md border-top-subtle">
                                    <div class="flex-between">
                                        <div>
                                            <span class="stat-label">ÊôÇÁµ¶ (Hourly Wage):</span>
                                            <span id="selected-emp-wage"
                                                class="font-semibold text-cyan ml-sm"></span>
                                        </div>
                                        <div>
                                            <span class="stat-label">ÊôÇÈñìÊÆãÈ´ò:</span>
                                            <span id="selected-emp-hours"
                                                class="font-semibold text-warning ml-sm"></span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Yukyu History Table (2 years) -->
                                <div id="yukyu-history-table"
                                    class="mt-lg pt-lg border-top-subtle">
                                    <div class="mb-md">
                                        <span class="stat-label">üìä Âπ¥Â∫¶Âà•ÊúâÁµ¶Â±•Ê≠¥ (2Âπ¥ÂàÜ)</span>
                                    </div>
                                    <table class="w-full text-sm" style="border-collapse: collapse;">
                                        <thead>
                                            <tr class="table-header-highlight">
                                                <th
                                                    class="p-sm text-left rounded-tl">
                                                    Âπ¥Â∫¶</th>
                                                <th class="p-sm text-center">‰ªò‰∏éÊó•Êï∞</th>
                                                <th class="p-sm text-center">‰ΩøÁî®Êó•Êï∞</th>
                                                <th class="p-sm text-center">ÊÆãÊó•Êï∞</th>
                                                <th
                                                    class="p-sm text-center rounded-tr">
                                                    Ê∂àÂåñÁéá</th>
                                            </tr>
                                        </thead>
                                        <tbody id="yukyu-history-tbody">
                                            <tr>
                                                <td colspan="5"
                                                    class="p-md text-center text-muted">
                                                    ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Usage History (dates) -->
                                <div id="usage-history-container"
                                    class="d-none mt-md pt-md border-top-subtle">
                                    <div class="mb-sm">
                                        <span class="stat-label">üìÖ ‰ΩøÁî®Â±•Ê≠¥ (Usage History)</span>
                                        <button type="button" onclick="App.requests.toggleUsageHistory()"
                                            class="ml-sm text-xs text-muted cursor-pointer" style="padding: 0.25rem 0.5rem; background: rgba(255,255,255,0.1); border: none; border-radius: 4px;">
                                            Ë©≥Á¥∞„ÇíË°®Á§∫
                                        </button>
                                    </div>
                                    <div id="usage-history-summary" class="text-sm text-muted">
                                    </div>
                                    <div id="usage-history-detail"
                                        class="d-none mt-sm max-h-200">
                                    </div>
                                </div>
                            </div>

                            <!-- SECTION 2: Date & Type -->
                            <div class="form-section">
                                <div class="form-section-title">üìÖ Êó•Á®ã„Å®Á®ÆÈ°û</div>

                                <div class="d-grid gap-md" style="grid-template-columns: 1fr 1fr;">
                                    <div class="form-group">
                                        <label for="start-date" class="required">ÈñãÂßãÊó• (Start Date)</label>
                                        <input class="input-glass w-full" type="date" id="start-date"
                                            onchange="App.requests.validateDates()"
                                            aria-describedby="start-date-validation">
                                        <div id="start-date-validation" class="validation-message"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="end-date" class="required">ÁµÇ‰∫ÜÊó• (End Date)</label>
                                        <input class="input-glass w-full" type="date" id="end-date"
                                            onchange="App.requests.validateDates()"
                                            aria-describedby="end-date-validation">
                                        <div id="end-date-validation" class="validation-message"></div>
                                    </div>
                                </div>

                                <div class="d-grid gap-md" style="grid-template-columns: 1fr 1fr;">
                                    <div class="form-group">
                                        <label for="leave-type" class="required">Á®ÆÈ°û (Type)</label>
                                        <select class="input-glass w-full" id="leave-type"
                                            onchange="App.requests.toggleLeaveType()">
                                            <option value="full">ÂÖ®Êó•‰ºëÊöá (Full Day)</option>
                                            <option value="half_am">ÂçàÂâçÂçä‰ºë (AM Half)</option>
                                            <option value="half_pm">ÂçàÂæåÂçä‰ºë (PM Half)</option>
                                            <option value="hourly">ÊôÇÈñì‰ºë (Hourly)</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="days-input-container">
                                        <label for="days-requested" class="required">Êó•Êï∞ (Days)</label>
                                        <input class="input-glass w-full" type="number" id="days-requested" min="0.5" step="0.5" value="1"
                                            oninput="App.requests.validateDays()" aria-describedby="days-validation">
                                        <div id="days-validation" class="validation-message"></div>
                                    </div>
                                    <div class="form-group d-none" id="hours-input-container">
                                        <label for="hours-requested" class="required">ÊôÇÈñìÊï∞ (Hours)</label>
                                        <input class="input-glass w-full" type="number" id="hours-requested" min="1" max="7" step="1" value="1"
                                            oninput="App.requests.updateCostEstimate(); App.requests.validateHours();"
                                            aria-describedby="hours-validation hours-hint">
                                        <div id="hours-validation" class="validation-message"></div>
                                        <div id="hours-hint"
                                            class="text-xs text-muted mt-xs">
                                            ‚Äª 1Êó•ÊúÄÂ§ß7ÊôÇÈñì„Åæ„Åß</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cost Estimate (shown for hourly leave) -->
                            <div id="cost-estimate-container"
                                class="d-none mb-xl info-card-warning">
                                <div class="flex-between">
                                    <span class="stat-label">üí∞ Ë¶ãÁ©ç„Ç≥„Çπ„Éà (Estimated Cost):</span>
                                    <span id="cost-estimate"
                                        class="text-xl font-bold text-warning"></span>
                                </div>
                            </div>

                            <!-- SECTION 3: Reason -->
                            <div class="form-section">
                                <div class="form-section-title">üìù ÁêÜÁî±</div>
                                <div class="form-group">
                                    <label for="leave-reason">ÁêÜÁî± (Reason) - ‰ªªÊÑè</label>
                                    <textarea class="input-glass w-full" id="leave-reason" style="min-height: 80px; resize: vertical;"
                                        placeholder="ÁßÅÁî®„ÄÅÈÄöÈô¢„ÄÅÊóÖË°å„Å™„Å©..." maxlength="200"
                                        oninput="App.requests.updateCharCounter()"
                                        aria-describedby="reason-char-counter"></textarea>
                                    <div class="char-counter" id="reason-char-counter">0 / 200</div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button class="btn btn-primary w-full p-md" id="submit-btn"
                                onclick="App.requests.showConfirmation()">
                                ‚úì ÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åô„Çã (Review & Submit)
                            </button>
                        </div>
                    </div>

                    <!-- Pending Requests -->
                    <div class="glass-panel col-span-2 p-lg">
                        <div class="flex-between mb-lg">
                            <h3 class="text-xl">
                                ‚è≥ ÊâøË™çÂæÖ„Å°
                                <span class="text-xs text-muted ml-sm">Pending
                                    Approvals</span>
                            </h3>
                            <button class="btn btn-glass" onclick="App.requests.loadPending()">
                                üîÑ Êõ¥Êñ∞
                            </button>
                        </div>

                        <div id="pending-requests" class="overflow-y-auto" style="max-height: 400px;">
                            <div class="empty-state">
                                Loading pending requests...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Request History -->
                <div class="glass-panel p-lg mt-2xl">
                    <h3 class="mb-2xl text-xl">
                        üìã Áî≥Ë´ãÂ±•Ê≠¥
                        <span class="text-xs text-muted ml-sm">Request
                            History</span>
                    </h3>
                    <div class="overflow-auto">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ÂæìÊ•≠Âì°</th>
                                    <th>ÊúüÈñì</th>
                                    <th>Êó•Êï∞</th>
                                    <th>ÁêÜÁî±</th>
                                    <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                    <th>Áî≥Ë´ãÊó•</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="requests-history">
                                <tr>
                                    <td colspan="8" class="text-center p-xl">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: COMPLIANCE -->
            <div class="view-section d-none" id="view-compliance">
                <div class="bento-grid">
                    <!-- 5 Day Compliance -->
                    <div class="glass-panel col-span-2 p-lg">
                        <div class="flex-between mb-lg">
                            <h3 class="text-xl">
                                üìä 5Êó•ÂèñÂæóÁæ©Âãô „ÉÅ„Çß„ÉÉ„ÇØ
                                <span class="text-xs text-muted ml-sm">5-Day
                                    Compliance Check</span>
                            </h3>
                            <button class="btn btn-primary" onclick="App.compliance.check5Day()">
                                üîç „ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å
                            </button>
                        </div>

                        <div id="compliance-summary"
                            class="d-grid gap-md mb-2xl" style="grid-template-columns: repeat(4, 1fr);">
                            <div class="stat-card text-center">
                                <div class="stat-label">ÂØæË±°ËÄÖ</div>
                                <div class="stat-value" id="comp-total">-</div>
                            </div>
                            <div class="stat-card text-center" style="border-color: var(--success);">
                                <div class="stat-label">ÈÅîÊàê</div>
                                <div class="stat-value text-success" id="comp-compliant">-
                                </div>
                            </div>
                            <div class="stat-card text-center" style="border-color: var(--warning);">
                                <div class="stat-label">Ë¶ÅÊ≥®ÊÑè</div>
                                <div class="stat-value text-warning" id="comp-atrisk">-</div>
                            </div>
                            <div class="stat-card text-center" style="border-color: var(--danger);">
                                <div class="stat-label">Êú™ÈÅîÊàê</div>
                                <div class="stat-value text-danger" id="comp-noncompliant">-
                                </div>
                            </div>
                        </div>

                        <div id="compliance-list" class="overflow-y-auto" style="max-height: 300px;">
                            <div class="empty-state">
                                Click "„ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å" to check compliance
                            </div>
                        </div>
                    </div>

                    <!-- Alerts -->
                    <div class="glass-panel col-span-2 p-lg">
                        <div class="flex-between mb-lg">
                            <h3 class="text-xl">
                                üö® „Ç¢„É©„Éº„Éà
                                <span class="text-xs text-muted ml-sm">Compliance
                                    Alerts</span>
                            </h3>
                            <button class="btn btn-glass" onclick="App.compliance.loadAlerts()">
                                üîÑ Êõ¥Êñ∞
                            </button>
                        </div>

                        <div id="alerts-container" class="overflow-y-auto" style="max-height: 400px;">
                            <div class="empty-state">
                                Loading alerts...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Annual Ledger -->
                <div class="glass-panel p-lg mt-2xl">
                    <div class="flex-between mb-lg">
                        <h3 class="text-xl">
                            üìí Âπ¥Ê¨°ÊúâÁµ¶‰ºëÊöáÁÆ°ÁêÜÁ∞ø
                            <span class="text-xs text-muted ml-sm">Annual
                                Leave Ledger (Required by Law)</span>
                        </h3>
                        <div class="flex-center gap-sm">
                            <button class="btn btn-glass" onclick="App.compliance.loadLedger()">
                                üìÑ Ë°®Á§∫
                            </button>
                            <button class="btn btn-primary" onclick="App.compliance.exportLedger('csv')">
                                üíæ CSVÂá∫Âäõ
                            </button>
                        </div>
                    </div>

                    <div id="ledger-container" class="overflow-auto" style="max-height: 400px;">
                        <div class="empty-state">
                            Click "Ë°®Á§∫" to load the annual ledger
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: CALENDAR -->
            <div class="view-section d-none" id="view-calendar">
                <div class="bento-grid">
                    <!-- Calendar Controls -->
                    <div class="glass-panel col-span-4 p-md">
                        <div class="flex-between mb-lg">
                            <div class="flex-center gap-md">
                                <button class="btn btn-glass" onclick="App.calendar.prevMonth()">‚óÄ</button>
                                <h3 id="calendar-month-title"
                                    class="text-2xl text-center" style="min-width: 200px;">2025Âπ¥ 12Êúà
                                </h3>
                                <button class="btn btn-glass" onclick="App.calendar.nextMonth()">‚ñ∂</button>
                            </div>
                            <div class="flex-center gap-sm">
                                <button class="btn btn-glass" onclick="App.calendar.goToToday()">‰ªäÊó•</button>
                                <button class="btn btn-primary" onclick="App.calendar.loadEvents()">üîÑ
                                    Êõ¥Êñ∞</button>
                            </div>
                        </div>

                        <!-- Legend -->
                        <div class="flex-center gap-lg mb-lg text-sm">
                            <span><span
                                    class="legend-box legend-box-cyan"></span>ÂÖ®Êó•‰ºëÊöá</span>
                            <span><span
                                    class="legend-box legend-box-cyan-dark"></span>ÂçàÂâçÂçä‰ºë</span>
                            <span><span
                                    class="legend-box legend-box-cyan-light"></span>ÂçàÂæåÂçä‰ºë</span>
                            <span><span
                                    class="legend-box legend-box-warning"></span>ÊôÇÈñì‰ºë</span>
                            <span><span
                                    class="legend-box legend-box-success"></span>‰ΩøÁî®Êó•</span>
                        </div>

                        <!-- Calendar Grid -->
                        <div id="calendar-grid" class="d-grid" style="grid-template-columns: repeat(7, 1fr); gap: 4px;">
                            <!-- Header -->
                            <div class="calendar-header">Êó•</div>
                            <div class="calendar-header">Êúà</div>
                            <div class="calendar-header">ÁÅ´</div>
                            <div class="calendar-header">Ê∞¥</div>
                            <div class="calendar-header">Êú®</div>
                            <div class="calendar-header">Èáë</div>
                            <div class="calendar-header">Âúü</div>
                            <!-- Days will be rendered by JS -->
                        </div>
                    </div>

                    <!-- Day Detail Panel -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="mb-lg text-lg">
                            üìã ÈÅ∏ÊäûÊó•„ÅÆË©≥Á¥∞
                            <span id="selected-date-display"
                                class="text-cyan ml-sm">-</span>
                        </h3>
                        <div id="day-detail-container" class="overflow-y-auto" style="max-height: 300px;">
                            <div class="empty-state">
                                Êó•‰ªò„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Summary -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="mb-lg text-lg">üìä ÊúàÈñì„Çµ„Éû„É™„Éº</h3>
                        <div id="monthly-summary-container">
                            <div class="d-grid gap-md" style="grid-template-columns: 1fr 1fr;">
                                <div class="stat-card text-center p-md">
                                    <div class="stat-label">‰ºëÊöáÂèñÂæóËÄÖÊï∞</div>
                                    <div class="stat-value text-2xl" id="cal-month-employees">-
                                    </div>
                                </div>
                                <div class="stat-card text-center p-md">
                                    <div class="stat-label">Á∑èÂèñÂæóÊó•Êï∞</div>
                                    <div class="stat-value text-2xl" id="cal-month-days">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: ANALYTICS -->
            <div class="view-section d-none" id="view-analytics">
                <div class="bento-grid">
                    <!-- Summary Cards -->
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Á∑èÂæìÊ•≠Âì°Êï∞</div>
                        <div class="stat-value" id="ana-total-emp">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Á∑è‰ªò‰∏éÊó•Êï∞</div>
                        <div class="stat-value text-cyan" id="ana-total-granted">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Á∑è‰ΩøÁî®Êó•Êï∞</div>
                        <div class="stat-value text-success" id="ana-total-used">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Âπ≥ÂùáÊ∂àÂåñÁéá</div>
                        <div class="stat-value text-warning" id="ana-avg-rate">-</div>
                    </div>

                    <!-- Department Chart -->
                    <div class="glass-panel col-span-2 p-md" style="height: 400px;">
                        <h3 class="stat-label mb-lg">ÈÉ®ÈñÄÂà•‰ΩøÁî®Êó•Êï∞</h3>
                        <div class="chart-container-sm">
                            <canvas id="chart-department"></canvas>
                        </div>
                    </div>

                    <!-- Employee Type Chart -->
                    <div class="glass-panel col-span-2 p-md" style="height: 400px;">
                        <h3 class="stat-label mb-lg">ÂæìÊ•≠Âì°„Çø„Ç§„ÉóÂà•</h3>
                        <div class="chart-container-sm">
                            <canvas id="chart-emp-type"></canvas>
                        </div>
                    </div>

                    <!-- Top Users -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">üèÜ Top 10 ‰ΩøÁî®ËÄÖ</h3>
                        <div id="top-users-list" class="overflow-y-auto" style="max-height: 300px;"></div>
                    </div>

                    <!-- High Balance -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">‚ö†Ô∏è ÊÆãÊó•Êï∞„ÅåÂ§ö„ÅÑÂæìÊ•≠Âì°</h3>
                        <div id="high-balance-list" class="overflow-y-auto" style="max-height: 300px;"></div>
                    </div>

                    <!-- Predictions -->
                    <div class="glass-panel col-span-4 p-md">
                        <div class="flex-between mb-lg">
                            <h3 class="stat-label">üìà Âπ¥Êú´‰∫àÊ∏¨„Éª5Êó•Áæ©ÂãôÈÅîÊàê„É™„Çπ„ÇØ</h3>
                            <button class="btn btn-glass" onclick="App.analytics.loadPredictions()">üîÑ
                                Êõ¥Êñ∞</button>
                        </div>
                        <div id="predictions-container">
                            <div
                                class="d-grid gap-md mb-lg" style="grid-template-columns: repeat(4, 1fr);">
                                <div class="stat-card text-center p-md">
                                    <div class="stat-label">ÁèæÂú®Êúà</div>
                                    <div id="pred-current-month" class="text-2xl font-bold">-
                                    </div>
                                </div>
                                <div class="stat-card text-center p-md">
                                    <div class="stat-label">ÊÆã„ÇäÊúàÊï∞</div>
                                    <div id="pred-remaining-months" class="text-2xl font-bold">-</div>
                                </div>
                                <div class="stat-card text-center p-md">
                                    <div class="stat-label">ÊúàÂπ≥Âùá‰ΩøÁî®</div>
                                    <div id="pred-avg-monthly" class="text-2xl font-bold">-
                                    </div>
                                </div>
                                <div class="stat-card text-center p-md" style="border-color: var(--danger);">
                                    <div class="stat-label">5Êó•Êú™ÈÅîÊàê„É™„Çπ„ÇØ</div>
                                    <div id="pred-at-risk"
                                        class="text-2xl font-bold text-danger">-
                                    </div>
                                </div>
                            </div>
                            <div id="at-risk-employees" class="max-h-200"></div>
                        </div>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="glass-panel p-md mt-2xl">
                    <h3 class="stat-label mb-lg">üì• „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</h3>
                    <div class="flex-center gap-md flex-wrap">
                        <button class="btn btn-primary" onclick="App.analytics.exportExcel('employees')">
                            üìä ÂæìÊ•≠Âì°„Éá„Éº„Çø (Excel)
                        </button>
                        <button class="btn btn-glass" onclick="App.analytics.exportExcel('requests')">
                            üìù Áî≥Ë´ã‰∏ÄË¶ß (Excel)
                        </button>
                        <button class="btn btn-glass" onclick="App.analytics.exportExcel('compliance')">
                            ‚úÖ ÁÆ°ÁêÜÁ∞ø (Excel)
                        </button>
                    </div>
                </div>
            </div>

            <!-- VIEW: MONTHLY REPORTS -->
            <div class="view-section d-none" id="view-reports">
                <div class="bento-grid">
                    <!-- Date Selector with Tabs -->
                    <div class="glass-panel col-span-4 p-md">
                        <div class="flex-between mb-xl flex-wrap gap-md">
                            <h3 class="text-xl">üìã „É¨„Éù„Éº„ÉàÊúüÈñì</h3>
                            <button class="btn btn-export" onclick="App.reports.exportReport()">
                                üì• ExcelÂá∫Âäõ
                            </button>
                        </div>

                        <!-- Tab Selector -->
                        <div class="tab-container mb-xl">
                            <button class="tab-btn active" id="tab-monthly" onclick="App.reports.setMode('monthly')">
                                üìÖ ÊúàÊ¨° (21Êó•„Äú20Êó•)
                            </button>
                            <button class="tab-btn" id="tab-custom" onclick="App.reports.setMode('custom')">
                                üîß ÊúüÈñìÊåáÂÆö
                            </button>
                        </div>

                        <!-- Monthly Mode -->
                        <div id="monthly-selector"
                            class="flex gap-md align-end mb-lg flex-wrap">
                            <div>
                                <label for="report-year" class="sr-only">Âπ¥Â∫¶ÈÅ∏Êäû</label>
                                <select id="report-year" class="input-glass" style="width: 120px;"
                                    onchange="App.reports.loadMonthList()" aria-label="Âπ¥Â∫¶„ÇíÈÅ∏Êäû">
                                </select>
                            </div>
                            <div>
                                <label for="report-month" class="sr-only">ÊúàÂ∫¶ÈÅ∏Êäû</label>
                                <select id="report-month" class="input-glass" style="width: 120px;"
                                    onchange="App.reports.loadReport()" aria-label="ÊúàÂ∫¶„ÇíÈÅ∏Êäû">
                                    <option value="1">1ÊúàÂ∫¶</option>
                                    <option value="2">2ÊúàÂ∫¶</option>
                                    <option value="3">3ÊúàÂ∫¶</option>
                                    <option value="4">4ÊúàÂ∫¶</option>
                                    <option value="5">5ÊúàÂ∫¶</option>
                                    <option value="6">6ÊúàÂ∫¶</option>
                                    <option value="7">7ÊúàÂ∫¶</option>
                                    <option value="8">8ÊúàÂ∫¶</option>
                                    <option value="9">9ÊúàÂ∫¶</option>
                                    <option value="10">10ÊúàÂ∫¶</option>
                                    <option value="11">11ÊúàÂ∫¶</option>
                                    <option value="12">12ÊúàÂ∫¶</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="App.reports.loadReport()">üîç Ë°®Á§∫</button>
                        </div>

                        <!-- Custom Mode -->
                        <div id="custom-selector" class="d-none mb-lg">
                            <div class="flex gap-md align-end flex-wrap">
                                <div>
                                    <label class="stat-label d-block mb-xs text-xs" for="report-start-date">ÈñãÂßãÊó•</label>
                                    <input type="date" id="report-start-date" class="input-glass" style="width: 160px;">
                                </div>
                                <div class="pb-md" aria-hidden="true">
                                    <span class="text-xl text-muted">„Äú</span>
                                </div>
                                <div>
                                    <label class="stat-label d-block mb-xs text-xs" for="report-end-date">ÁµÇ‰∫ÜÊó•</label>
                                    <input type="date" id="report-end-date" class="input-glass" style="width: 160px;">
                                </div>
                                <button class="btn btn-primary" onclick="App.reports.loadCustomReport()">üîç
                                    Ë°®Á§∫</button>
                            </div>
                            <div class="mt-md text-sm text-muted">
                                ‚Äª Ë§áÊï∞Êúà„Å´„Åæ„Åü„Åå„ÇãÊúüÈñì„ÇÇOKÔºà‰æã: 1/16 „Äú 2/20Ôºâ
                            </div>
                        </div>

                        <!-- Period Display -->
                        <div id="report-period-display"
                            class="text-center p-md bg-cyan-subtle rounded">
                            <span class="text-xl font-semibold" id="report-period-label">-</span>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">ÂèñÂæóËÄÖÊï∞</div>
                        <div class="stat-value" id="rpt-emp-count">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Á∑èÂèñÂæóÊó•Êï∞</div>
                        <div class="stat-value text-cyan" id="rpt-total-days">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">Á∑èÂèñÂæóÊôÇÈñì</div>
                        <div class="stat-value text-warning" id="rpt-total-hours">-</div>
                    </div>
                    <div class="glass-panel stat-card col-span-1">
                        <div class="stat-label">1‰∫∫Âπ≥Âùá</div>
                        <div class="stat-value text-success" id="rpt-avg-days">-</div>
                    </div>

                    <!-- Employee List -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">üë• ÂèñÂæóËÄÖ‰∏ÄË¶ß</h3>
                        <div id="report-employee-list" class="overflow-y-auto" style="max-height: 400px;">
                            <div class="empty-state">
                                Êúà„ÇíÈÅ∏Êäû„Åó„Å¶„É¨„Éù„Éº„Éà„ÇíË°®Á§∫
                            </div>
                        </div>
                    </div>

                    <!-- Factory Summary -->
                    <div class="glass-panel col-span-2 p-md">
                        <h3 class="stat-label mb-lg">üè≠ Ê¥æÈÅ£ÂÖàÂà•ÈõÜË®à</h3>
                        <div id="report-factory-list" class="overflow-y-auto" style="max-height: 400px;">
                            <div class="empty-state">
                                Êúà„ÇíÈÅ∏Êäû„Åó„Å¶„É¨„Éù„Éº„Éà„ÇíË°®Á§∫
                            </div>
                        </div>
                    </div>

                    <!-- Daily Breakdown -->
                    <div class="glass-panel col-span-4 p-md">
                        <h3 class="stat-label mb-lg">üìÖ Êó•Âà•ÂèñÂæóÁä∂Ê≥Å</h3>
                        <div id="report-daily-grid"
                            class="d-grid gap-sm overflow-y-auto" style="grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); max-height: 300px;">
                            <div class="empty-state col-span-full">
                                Êúà„ÇíÈÅ∏Êäû„Åó„Å¶„É¨„Éù„Éº„Éà„ÇíË°®Á§∫
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Year Overview -->
                <div class="glass-panel p-md mt-2xl">
                    <h3 class="stat-label mb-lg">üìä Âπ¥ÈñìÊúàÂà•„Çµ„Éû„É™„Éº</h3>
                    <div class="overflow-auto">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>ÊúàÂ∫¶</th>
                                    <th>ÊúüÈñì</th>
                                    <th>ÂèñÂæóËÄÖÊï∞</th>
                                    <th>Á∑èÊó•Êï∞</th>
                                    <th>Ë©≥Á¥∞</th>
                                </tr>
                            </thead>
                            <tbody id="report-year-summary">
                                <tr>
                                    <td colspan="5" class="text-center p-xl">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div class="view-section d-none" id="view-settings">
                <div class="glass-panel p-lg">
                    <h3 class="mb-2xl text-xl">‚öôÔ∏è „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö</h3>

                    <div class="d-grid gap-xl">
                        <!-- System Status -->
                        <div>
                            <h4 class="stat-label mb-lg">„Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã</h4>
                            <div id="system-status"
                                class="d-grid gap-md" style="grid-template-columns: repeat(3, 1fr);">
                                <div class="stat-card text-center">
                                    <div class="stat-label">Database Size</div>
                                    <div class="stat-value" id="sys-db-size">-</div>
                                </div>
                                <div class="stat-card text-center">
                                    <div class="stat-label">Total Employees</div>
                                    <div class="stat-value" id="sys-emp-count">-</div>
                                </div>
                                <div class="stat-card text-center">
                                    <div class="stat-label">Health Status</div>
                                    <div class="stat-value text-success" id="sys-health">-
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management -->
                        <div>
                            <h4 class="stat-label mb-lg">„Éá„Éº„ÇøÁÆ°ÁêÜ</h4>
                            <div class="flex gap-md flex-wrap">
                                <button class="btn btn-glass" onclick="App.settings.loadSnapshot()">
                                    üìä SnapshotÊõ¥Êñ∞
                                </button>
                                <button class="btn btn-glass" onclick="App.settings.viewAuditLog()">
                                    üìú Áõ£Êüª„É≠„Ç∞
                                </button>
                                <button class="btn btn-glass" onclick="App.data.sync()"
                                    style="background: rgba(56, 189, 248, 0.2);">
                                    ‚ö° „Éá„Éº„ÇøÂêåÊúü
                                </button>
                            </div>
                        </div>

                        <!-- Backup Management -->
                        <div>
                            <h4 class="stat-label mb-lg">üì¶ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÁÆ°ÁêÜ</h4>
                            <div class="flex gap-md flex-wrap">
                                <button class="btn btn-primary" onclick="App.backup.create()">
                                    üì¶ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰ΩúÊàê
                                </button>
                                <button class="btn btn-glass" onclick="App.backup.showBackupList()">
                                    üìã „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰∏ÄË¶ß
                                </button>
                            </div>
                            <div class="mt-md text-sm text-muted">
                                ‚Äª „Çµ„Éº„Éê„ÉºËµ∑ÂãïÊôÇ„Å´Ëá™Âãï„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åô„ÄÇÊúÄÂ§ß10‰ª∂‰øùÊåÅ„ÄÇ
                            </div>
                        </div>

                        <!-- API Info -->
                        <div>
                            <h4 class="stat-label mb-lg">APIÊÉÖÂ†±</h4>
                            <div
                                class="p-md rounded text-sm" style="background: rgba(0,0,0,0.3); font-family: 'JetBrains Mono', monospace;">
                                <div class="text-muted">Base URL:</div>
                                <div class="text-cyan">http://localhost:8000/api</div>
                                <div class="text-muted mt-sm">Documentation:</div>
                                <div><a href="/docs" target="_blank"
                                        class="text-cyan">http://localhost:8000/docs</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- UI Elements -->
    <div class="loader-overlay" id="loader">
        <div class="spinner"></div>
        <div>Ë™≠„ÅøËæº„Åø‰∏≠</div>
    </div>

    <div class="toast-container" role="status" aria-live="polite" aria-atomic="true" id="toast-container"></div>

    <!-- Simple Modal for Details -->
    <div class="loader-overlay" id="detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title"
        style="background: rgba(0,0,0,0.7);">
        <div class="glass-panel modal-content-container">
            <button
 class="btn modal-close-btn"                onclick="App.ui.closeModal()" aria-label="Close modal">‚úï</button>
            <div class="p-xl">
                <h2 id="modal-title" class="mb-lg">Employee Details</h2>
                <div id="modal-content"></div>
            </div>
        </div>
    </div>

    <!-- Flatpickr Script -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/l10n/ja.js"></script>

    <!-- Flatpickr Initialization -->
    <script>
            // Get current theme dynamically
            const getCurrentTheme = () => {
                return document.documentElement.getAttribute('data-theme') || 'dark';
            };

        document.addEventListener('DOMContentLoaded', function () {
            // Common Flatpickr configuration
            const flatpickrConfig = {
                locale: 'ja',
                dateFormat: 'Y-m-d',
                altInput: true,
                altFormat: 'YÂπ¥mÊúàdÊó• (D)',
                allowInput: true,
                clickOpens: true,
                theme: getCurrentTheme(), // Tema din√°mico basado en data-theme
                position: 'auto',
                animate: true,
                monthSelectorType: 'dropdown',
                shorthandCurrentMonth: false,
                yearSelectorType: 'dropdown',
                disableMobile: false,
                onReady: function (selectedDates, dateStr, instance) {
                    // Add custom icon to the input wrapper
                    const input = instance.input;
                    if (!input.parentElement.querySelector('.flatpickr-icon')) {
                        const icon = document.createElement('span');
                        icon.className = 'flatpickr-icon';
                        icon.textContent = 'üìÖ';
                        icon.style.cssText = 'position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; font-size: 1.2rem; opacity: 0.6;';
                        input.parentElement.style.position = 'relative';
                        input.parentElement.appendChild(icon);
                    }
                },
                onChange: function (selectedDates, dateStr, instance) {
                    // Trigger the original onchange event if exists
                    const event = new Event('change', { bubbles: true });
                    instance.input.dispatchEvent(event);
                }
            };

            // Initialize Start Date picker
            const startDateInput = document.getElementById('start-date');
            if (startDateInput) {
                const startDatePicker = flatpickr(startDateInput, {
                    ...flatpickrConfig,
                    onChange: function (selectedDates, dateStr, instance) {
                        // Update end date minimum
                        if (endDatePicker && selectedDates.length > 0) {
                            endDatePicker.set('minDate', selectedDates[0]);
                        }
                        // Trigger original validation
                        if (typeof App !== 'undefined' && App.requests && App.requests.validateDates) {
                            App.requests.validateDates();
                        }
                    }
                });

                window.startDatePicker = startDatePicker;
            }

            // Initialize End Date picker
            const endDateInput = document.getElementById('end-date');
            if (endDateInput) {
                const endDatePicker = flatpickr(endDateInput, {
                    ...flatpickrConfig,
                    onChange: function (selectedDates, dateStr, instance) {
                        // Update start date maximum
                        if (startDatePicker && selectedDates.length > 0) {
                            startDatePicker.set('maxDate', selectedDates[0]);
                        }
                        // Trigger original validation
                        if (typeof App !== 'undefined' && App.requests && App.requests.validateDates) {
                            App.requests.validateDates();
                        }
                    }
                });

                window.endDatePicker = endDatePicker;
            }

            // Initialize Report Date pickers (for custom report range)
            const reportStartDate = document.getElementById('report-start-date');
            if (reportStartDate) {
                const reportStartPicker = flatpickr(reportStartDate, {
                    ...flatpickrConfig,
                    onChange: function (selectedDates, dateStr, instance) {
                        if (reportEndPicker && selectedDates.length > 0) {
                            reportEndPicker.set('minDate', selectedDates[0]);
                        }
                    }
                });
                window.reportStartPicker = reportStartPicker;
            }

            const reportEndDate = document.getElementById('report-end-date');
            if (reportEndDate) {
                const reportEndPicker = flatpickr(reportEndDate, {
                    ...flatpickrConfig,
                    onChange: function (selectedDates, dateStr, instance) {
                        if (reportStartPicker && selectedDates.length > 0) {
                            reportStartPicker.set('maxDate', selectedDates[0]);
                        }
                    }
                });
                window.reportEndPicker = reportEndPicker;
            }

            console.log('‚úÖ Flatpickr date pickers initialized with Japanese locale and custom theme');
        });
    </script>

    <script src="/static/js/app.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Optional: Show custom install button
            console.log('PWA install available');
        });
    </script>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="confirm-modal" onclick="if(event.target === this) App.requests.hideConfirmation()">
        <div class="confirm-modal-content">
            <div class="confirm-modal-title">
                ‚úÖ Áî≥Ë´ãÂÜÖÂÆπ„ÅÆÁ¢∫Ë™ç
            </div>

            <div class="confirm-summary">
                <div class="confirm-row">
                    <span class="confirm-row-label">ÂæìÊ•≠Âì°</span>
                    <span class="confirm-row-value" id="confirm-employee">-</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-row-label">Â∑•Â†¥</span>
                    <span class="confirm-row-value" id="confirm-factory">-</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-row-label">ÊúüÈñì</span>
                    <span class="confirm-row-value" id="confirm-dates">-</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-row-label">Á®ÆÈ°û</span>
                    <span class="confirm-row-value" id="confirm-type">-</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-row-label">Êó•Êï∞/ÊôÇÈñì</span>
                    <span class="confirm-row-value highlight" id="confirm-amount">-</span>
                </div>
                <div class="confirm-row d-none" id="confirm-cost-row">
                    <span class="confirm-row-label">Ë¶ãÁ©ç„Ç≥„Çπ„Éà</span>
                    <span class="confirm-row-value text-warning" id="confirm-cost">-</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-row-label">ÊÆã„ÇäÊó•Êï∞</span>
                    <span class="confirm-row-value" id="confirm-balance">-</span>
                </div>
                <div class="confirm-row" id="confirm-reason-row">
                    <span class="confirm-row-label">ÁêÜÁî±</span>
                    <span class="confirm-row-value text-right" id="confirm-reason" style="max-width: 200px;">-</span>
                </div>
            </div>

            <div
                class="p-md bg-warning-subtle rounded mb-lg text-sm text-warning">
                ‚ö†Ô∏è „Åì„ÅÆÂÜÖÂÆπ„ÅßÁî≥Ë´ã„ÇíÈÄÅ‰ø°„Åó„Åæ„Åô„ÅãÔºü
            </div>

            <div class="confirm-actions">
                <button class="btn btn-glass" onclick="App.requests.hideConfirmation()">
                    ‚Üê Êàª„Çã
                </button>
                <button class="btn btn-primary" id="confirm-submit-btn" onclick="App.requests.submitConfirmed()">
                    üì§ Áî≥Ë´ã„Åô„Çã
                </button>
            </div>
        </div>
    </div>
</body>

</html>